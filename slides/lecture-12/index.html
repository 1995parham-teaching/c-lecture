---
index: 12
title: Files
topics:
  - Introduction
  - Text File Operations
  - Binary File Operations
  - Bugs and avoiding them
---

<section>
  <div class="toc"></div>
</section>
<section>
  <div class="toc" data-selected="0"></div>
</section>
<section>
  <h2>Introduction</h2>
  <ul>
    <li>Data storages of computers:</li>
    <ol>
      <li>Main memory (RAM)</li>
      <ul>
        <li>It is <span class="hl-orange">volatile</span></li>
        <li>Read / Write data using <span class="hl-green">variables</span></li>
      </ul>
      <li>Secondary storage (Hard Disk)</li>
      <ul>
        <li>
          It is <span class="hl-red">not</span>
          <span class="hl-orange">volatile</span>
        </li>
        <li>Read / Write data using <span class="hl-green">files</span></li>
      </ul>
    </ol>
  </ul>
</section>
<section>
  <h2>Text &amp; Binary Files</h2>
  <ul>
    <li>How does computer store data?</li>
    <ul>
      <li>They are coded</li>
    </ul>
    <li>When data are stored in main memory</li>
    <ul>
      <li>It is variable</li>
      <li>Coding is specified by the type: int, char, ...</li>
    </ul>
    <li>When data are stored in secondary memory</li>
    <ul>
      <li>It is file</li>
      <li>Coding is specified by the file type: Text &amp; Binary</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Text Files</h2>
  <ul>
    <li>ASCII encoding</li>
    <li>Each line is a string</li>
    <li>Each line is terminated by \n</li>
    <li>Human-readable files</li>
    <ul>
      <li>Editable by text editor (e.g. Notepad)</li>
    </ul>
    <li>Examples</li>
    <ul>
      <li>C source files</li>
      <li>Every .txt files</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Binary Files</h2>
  <ul>
    <li>Binary encoding</li>
    <ul>
      <li>
        int, double, float, struct, ... are directly (as 0,1) stored in the file
      </li>
    </ul>
    <li>Human unreadable files</li>
    <ul>
      <li>Is not editable by text editor</li>
      <li>Needs special editor which understands the file</li>
    </ul>
    <li>Examples</li>
    <ul>
      <li>.exe files</li>
      <li>Media files such as .mp3</li>
      <li>Picture files such as .bmp, .jpg</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Working with Files</h2>
  <ul>
    <li>Until now</li>
    <ul>
      <li>We read/write data from/to terminal (console)</li>
    </ul>
    <li>In C</li>
    <ul>
      <li>We can read data from file</li>
      <li>We can write data to file</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Working with Files</h2>
  <p>Main steps in working with files:</p>
  <ol>
    <li>Open file</li>
    <ul>
      <li>Get a file handler from Operating System</li>
    </ul>
    <li>Read/Write</li>
    <ul>
      <li>Use the handler</li>
    </ul>
    <li>Close file</li>
    <ul>
      <li>Free the handler</li>
    </ul>
    <li>Other operations</li>
    <ul>
      <li>Check end of file, skip in file, ...</li>
    </ul>
  </ol>
</section>
<section>
  <h2>Opening Files</h2>
  <ul>
    <li>Function <span class="hl-violet">fopen</span> opens files</li>
    <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;
FILE* fopen(char* name, char* mode);
    </code></pre>
    <li><span class="hl-orange">FILE*</span> is a struct</li>
    <ul>
      <li>Saves information about file.</li>
      <li>We <span class="hl-green">don’t need</span> to know about it.</li>
    </ul>
    <li>
      If cannot open file, fopen returns <span class="hl-red">NULL</span>.
    </li>
    <li>name is the name of file:</li>
    <ul>
      <li><span class="hl-cyan">Absolute</span> name: C:\prog\test.txt</li>
      <li><span class="hl-cyan">Relative</span> name: Mytest.txt</li>
    </ul>
  </ul>
</section>
<section>
  <section>
    <h2>Opening Files: Modes</h2>
    <table>
      <thead>
        <tr>
          <th>File Mode</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="hl-cyan">r</span></td>
          <td>
            Open a file for <span class="hl-orange">reading</span>. If a file is
            in reading mode, then
            <span class="hl-green">no data is deleted</span> if a file is
            already present on a system.
          </td>
        </tr>
        <tr>
          <td><span class="hl-cyan">w</span></td>
          <td>
            Open a file for <span class="hl-orange">writing</span>. If a file is
            in writing mode, then a new file is created if a file doesn't exist
            at all. If a file is already present on a system, then
            <span class="hl-green"
              >all the data inside the file is truncated</span
            >, and it is opened for writing purposes.
          </td>
        </tr>
      </tbody>
    </table>
  </section>
  <section>
    <table>
      <thead>
        <tr>
          <th>File Mode</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="hl-cyan">a</span></td>
          <td>
            Open a file in append mode. If a file is in append mode, then the
            file is opened. The content within the file doesn't change.
          </td>
        </tr>
        <tr>
          <td><span class="hl-cyan">r+</span></td>
          <td>open for reading and writing from beginning</td>
        </tr>
        <tr>
          <td><span class="hl-cyan">w+</span></td>
          <td>open for reading and writing, overwriting a file</td>
        </tr>
        <tr>
          <td><span class="hl-cyan">a+</span></td>
          <td>open for reading and writing, appending to file</td>
        </tr>
      </tbody>
    </table>
  </section>
</section>
<section>
  <h2>Opening Files: Modes</h2>
  <ul>
    <li>Files are</li>
    <ul>
      <li>Text: Some strings</li>
      <li>Binary: Image file, Video file, ...</li>
    </ul>
    <li>To open binary file, we should add b to the mode.</li>
    <ul>
      <li>rb : open binary file for read</li>
      <li>w+b: create new binary file for read and write</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Opening Files: Example</h2>
  <pre><code class="hljs lang-c">
FILE *fp;
fp = fopen("c:\\test.txt", "r");
if(fp == NULL){
  printf("Cannot open file\n");
  return -1;
}
  </code></pre>
  <p>Open file c:\test.txt for reading</p>
</section>
<section>
  <h2>File-Position Pointer (FPP)</h2>
  <ul>
    <li>File-Position Pointer</li>
    <ul>
      <li>A pointer in file</li>
      <li>
        Points to <span class="hl-orange">current location</span> of read and
        write
      </li>
    </ul>
    <li>When file is open</li>
    <ul>
      <li>
        File-Position Pointer is set to
        <span class="hl-cyan">start of file</span> except for
        <span class="hl-green">"a"</span> mode
      </li>
    </ul>
    <li>When you read/write from/to file</li>
    <ul>
      <li>
        The File-Position Pointer
        <span class="hl-violet">advance according to the size of data</span>
      </li>
      <ul>
        <li>If you read 2 bytes, it moves 2 bytes</li>
        <li>If you write 50 bytes, it advances 50 bytes</li>
      </ul>
    </ul>
  </ul>
</section>
<section>
  <h2>Closing Files</h2>
  <ul>
    <li>Each opened file should be closed.</li>
    <li>If we write to a file and don’t close it, some of data may be LOST</li>
    <li>To close the file</li>
    <pre><code class="hljs lang-c">
fclose(FILE *fp);
    </code></pre>
  </ul>
</section>
<section>
  <div class="toc" data-selected="1"></div>
</section>
<section>
  <h2>Reading/Writing Text File</h2>
  <ul>
    <li><span class="hl-orange">fscanf</span> reads from file.</li>
    <li>
      <span class="hl-orange">fscanf</span> is same to
      <span class="hl-green">scanf</span>.
    </li>
    <li>Returns EOF if reached to the end of file.</li>
    <hr />
    <li><span class="hl-cyan">fprintf</span> writes to file.</li>
    <li>
      <span class="hl-cyan">fprintf</span> is same to
      <span class="hl-violet">printf</span>.
    </li>
  </ul>
  <pre><code class="hljs lang-c">
int fscanf(FILE *fp,"format", parameters);
int fprintf(FILE *fp,"format", parameters);
  </code></pre>
</section>
<section>
  <h2>Text File: Example</h2>
  <pre><code>
&lt;Number of students&gt;
&lt;id of student 1&gt; &lt;grade of student 1&gt;
&lt;id of student 2&gt; &lt;grade of student 2&gt;
...
&lt;id of student n&gt; &lt;grade of student n&gt;
  </code></pre>
</section>
<section>
  <h2>Average of Students' Grade</h2>
  <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
  FILE* fpin;

  char inname[20];

  int num, i, id;

  double sum, average, grade;

  printf("Enter the name of input file: ");
  scanf("%s", inname);

  fpin = fopen(inname, "r");
  if (fpin == NULL) {
    printf("Cannot open %s\n", inname);
    return -1;
  }

  /* Read the number of students */
  fscanf(fpin, "%d", &amp;num);

  /* Read the id and grade from file */
  sum = 0;
  for(i = 0; i &lt; num; i++){
    fscanf(fpin, "%d %lf", &amp;id, &amp;grade);
    sum += grade;
  }

  average = sum / num;
  printf("Average = %lf\n", average);

  fclose(fpin);
  return 0;
}
  </code></pre>
</section>
<section>
  <h2>Upper Average Students 🤓 v1</h2>
  <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
  FILE* fpin;
  FILE* fpout;

  char inname[20], outname[20];
  int num, i, id;
  double sum, average, grade;

  printf("Enter the name of input file: ");
  scanf("%s", inname);

  printf("Enter the name of output file: ");
  scanf("%s", outname);

  fpin = fopen(inname, "r");
  if (fpin == NULL) {
    printf("Cannot open %s\n", inname);
    return -1;
  }

  fpout = fopen(outname, "w");
  if(fpout == NULL){
    printf("Cannot open %s\n", outname); return -1;
  }

  /* Read the number of students */
  fscanf(fpin, "%d", &amp;num);

  /* Read the id and grade from file */
  sum = 0;
  for(i = 0; i &lt; num; i++){
    fscanf(fpin, "%d %lf", &amp;id, &amp;grade);
    sum += grade;
  }

  average = sum / num;

  fclose(fpin);

  fpin = fopen(inname, "r");

  fscanf(fpin,"%d", &amp;num);
  fprintf(fpout, "%lf\n", average);

  for(i = 0; i &lt; num; i++) {
    fscanf(fpin, "%d %lf", &amp;id, &amp;grade);

    if(grade &gt;= average)
      fprintf(fpout, "%d: %s\n", id, "passed");
    else
      fprintf(fpout, "%d: %s\n", id, "failed");
  }

  fclose(fpin);

  fclose(fpout);

  return 0;
}
  </code></pre>
</section>
<section>
  <h2>Upper Average Students 🤓 v2</h2>
  <pre><code class="hljs lang-c">
#include &lt;tstdio.h&gt;
#include &lt;stdlib.h&gt;

struct student {
  int id;
  double grade;
};

int main() {
  char inname[200];
  char outname[200];
  FILE *fpin;
  FILE *fpout;
  struct student *students;

  int num;
  double sum = 0;

	printf("input file: ");
	scanf("%s", inname);

  printf("output file: ");
  scanf("%s", outname);

	fpin = fopen(inname, "r");
	if (fpin == NULL) {
		printf("cannot open file %s\n", inname);
		return 1;
	}

  fpout = fopen(outname, "w");
  if (fpout == NULL) {
		printf("cannot open file %s\n", outname);
		return 1;
  }

	fscanf(fpin, "%d", &amp;num);

  students = malloc(num * sizeof(struct student));

  for (int i = 0; i &lt; num; i++) {
		int id;
    double grade;

    fscanf(fpin, "%d %lf", &amp;id, &amp;grade);

    sum += grade;

    students[i].id = id;
    students[i].grade = grade;

    printf("id: %d, grade: %lf\n", id, grade);
  }

  double average = sum / num;
  printf("average: %lf\n", average);

  for (int i = 0; i &lt; num; i++) {
    if (students[i].grade &gt;= average) {
      fprintf(fpout, "%d\n", students[i].id);
    }
  }

  fclose(fpin);
}
  </code></pre>
</section>
<section>
  <h2>Reading/Writing Characters (Text Files)</h2>
  <ul>
    <li>To write a character to file</li>
    <pre><code class="hljs lang-c">
fputc(char c, FILE *fp)
    </code></pre>
    <li>To read a char from file</li>
    <pre><code class="hljs lang-c">
char fgetc(FILE *fp);
    </code></pre>
  </ul>
  <p>Returns EOF if reaches to End of File</p>
</section>
<section>
  <h2>cp &lt;src&gt; &lt;dst&gt;</h2>
  <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main() {
  FILE* fpin;
  FILE* fpout;
  char inname[20], outname[20];
  char c;

  printf("Enter the name of input file: ");
  scanf("%s", inname);

  printf("Enter the name of output file: ");
  scanf("%s", outname);

  fpin = fopen(inname, "r");
  if (fpin == NULL){
    printf("Cannot open %s\n", inname);
    return -1;
  }

  fpout = fopen(outname, "w");
  if (fpout == NULL) {
    printf("Cannot open %s\n", outname);
    return -1;
  }

  // 😱
  while((c = fgetc(fpin)) != EOF)
    fputc(c, fpout);

  fclose(fpin);
  fclose(fpout);
  return 0;
}
  </code></pre>
</section>
<section>
  <section>
    <h2>Checking End of File</h2>
    <ul>
      <li>Each file has two indicators</li>
      <ul>
        <li>End of fie indicator</li>
        <li>Error indicator</li>
      </ul>
      <li>
        These indicators are set when we want to read but there is not enough
        data or there is an error
      </li>
      <li>How to use</li>
      <ul>
        <li>Try to read</li>
        <li>If the number of read object is less than expected</li>
        <ul>
          <li>Check end of file &rarr; feof</li>
          <li>Check error of file &rarr; ferror</li>
        </ul>
      </ul>
    </ul>
  </section>
  <section>
    <p>
      feof tells that an attempt has been made to read past the end of the file,
      which is not the same as that we just read the last data item from a file.
      We have to read one past the last data item for feof to return nonzero.
    </p>
  </section>
</section>
<section>
  <h2>Checking End of File</h2>
  <pre><code class="hljs lang-c">
while(1){
  c = fgetc(fpin);
  if(feof(fpin))
    break;
  fputc(c, fpout);
}
  </code></pre>
</section>
<section>
  <h2>Read/Write a Line</h2>
  <ul>
    <li>We can read a line of file</li>
    <ul>
      <li>
        <span class="hl-green">fscanf</span> reads until the first free space
      </li>
    </ul>
    <pre><code class="hljs lang-c">
char* fgets(char* buff, int maxnumber, FILE* fp);
    </code></pre>
    <li>Read at most <span class="hl-orange">maxnumber-1</span> chars</li>
    <li>
      Reading stops after <span class="hl-cyan">EOF</span> or
      <span class="hl-cyan">\n</span>
    </li>
    <li>If a <span class="hl-cyan">\n</span> is read it is stored in buffer</li>
    <li>Add <span class="hl-violet">\0</span> to the end of string</li>
    <li>
      If reach to end of file without reading any character, return
      <span class="hl-red">NULL</span>
    </li>
  </ul>
</section>
<section>
  <h2>Read/Write a Line</h2>
  <ul>
    <li>We can write a line to file</li>
    <pre><code class="hljs lang-c">
int fputs(char* buff, FILE* fp);
    </code></pre>
    <li>Write the string <span class="hl-orange">buff</span> to file</li>
    <li>Does <span class="hl-red">NOT</span> add \n at the end</li>
  </ul>
</section>
<section>
  <h2>Read/Write a Line</h2>
  <ul>
    <li>Read a line without knowing its maximum length</li>
    <li>
      The caller may provide a pointer to a malloced buffer for the line in
      <span class="hl-orange">*linep</span> , and the capacity of the buffer in
      <span class="hl-green">*linecapp</span>.
    </li>
    <pre><code class="hljs lang-c">
int getline(char** linep, int* linecapp, FILE* stream);
    </code></pre>
  </ul>
</section>
<section>
  <h2>Example: Count the number of lines</h2>
  <pre><code class="hljs lang-c">
char buf[500]; // 500 &gt; every line length

char inname[] = "1.txt";

FILE* fpin = fopen(inname, "r");
if (fpin == NULL) {
  printf("Cannot open %s\n", inname);
  return -1;
}

int count = 0;

while(fgets(buf, 500, fpin) != NULL)
  count++;

printf("Number of Lines = %d\n", count);
  </code></pre>
</section>
<section>
  <h2>Example: Count the number of lines</h2>
  <pre><code class="hljs lang-c">
char *buf = NULL;

char inname[] = "1.txt";

FILE* fpin = fopen(inname, "r");
if (fpin == NULL) {
  printf("Cannot open %s\n", inname);
  return -1;
}

int count = 0;
int length = 0;

while(getline(&amp;buf, &amp;length, fpin) &gt; -1) {
  count++;
  free(buf);
  buf = NULL;
}

printf("Number of Lines = %d\n", count);
  </code></pre>
</section>
<section>
  <h2>Maximum Line Length Issue</h2>
  <pre><code class="hljs lang-c">
12345678910
123
  </code></pre>
  <p>fgets with maxlen = 10</p>
  <pre><code class="hljs lang-c">
Number of Lines = 3
  </code></pre>
  <p>getline</p>
  <pre><code class="hljs lang-c">
Number of Lines = 2
  </code></pre>
</section>
<section>
  <div class="toc" data-selected="2"></div>
</section>
<section>
  <h2>Binary Files: A Different File Format</h2>
  <ul>
    <li>Data in binary files are</li>
    <ul>
      <li>Not encoded in ASCII format</li>
      <li>Encoded in binary format</li>
    </ul>
    <li>We must use different functions to read/write from/to binary files</li>
    <ul>
      <li>Why?</li>
      <li>
        Because, data should not be converted to/from ASCII encoding in
        writing/reading the files
      </li>
    </ul>
  </ul>
</section>
<section>
  <section>
    <h2>No Conversion to ASCII</h2>
    <ul>
      <li>In text files, everything is saved as ASCII codes</li>
      <ul>
        <pre><code class="hljs lang-c">
fprintf(fp, “%d”, 10)
        </code></pre>
        <li>Saves 2 bytes in the file: ASCII ‘1’ ASCII ‘0’</li>
        <pre><code class="hljs">
00110001 00110000
        </code></pre>
        <pre><code class="hljs lang-c">
fscanf(fp, “%d”, &amp;i)
        </code></pre>
        <li>
          Read 2 bytes from file (ASCII ‘1’ ASCII ‘0’) and convert it to base 2
          which mean integer number 10
        </li>
      </ul>
    </ul>
  </section>
  <section>
    <h2>No Conversion to ASCII</h2>
    <ul>
      <li>
        In binary files, there is not any binary to text conversion, everything
        is read/write in binary format
      </li>
      <ul>
        <pre><code class="hljs lang-c">
int i = 10;
fwrite(&amp;i, sizeof(int), 1, fp)
        </code></pre>
        <li>Saves 4 bytes in the file: The code of 10 in base 2</li>
        <pre><code class="hljs">
00000000 00000000 00000000 00001010
        </code></pre>
        <pre><code class="hljs lang-c">
fread(&amp;i, sizeof(int), 1, fp)
        </code></pre>
        <li>Reads 4 bytes from file into i (without any conversion)</li>
      </ul>
    </ul>
  </section>
</section>
<section>
  <h2>Writing to Binary Files</h2>
  <pre><code class="hljs lang-c">
int fwrite(void *buf, int size, int num, FILE *fp)
  </code></pre>
  <ul>
    <li>
      Writes <span class="hl-orange">num</span> objects from
      <span class="hl-green">buf</span> to <span class="hl-violet">fp</span>.
    </li>
    <li>Size of each object is <span class="hl-yellow">size</span>.</li>
    <li>Returns the number of written objects.</li>
    <li>If (return_val &lt; <span class="hl-orange">num</span>)</li>
    <ul>
      <li>There is an error</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Reading from Binary Files</h2>
  <pre><code class="hljs lang-c">
int fread(void *buf, int size, int num, FILE *fp)
  </code></pre>
  <ul>
    <li>
      Reads <span class="hl-orange">num</span> objects from file
      <span class="hl-violet">fp</span> to <span class="hl-green">buf</span>.
    </li>
    <li>Size of each object is <span class="hl-yellow">size</span>.</li>
    <li>Returns the number of read objects.</li>
    <li>If (return val &lt; <span class="hl-orange">num</span>)</li>
    <ul>
      <li>There is an error</li>
      <li>Or EOF &rarr; Check with feof</li>
    </ul>
  </ul>
</section>
<section>
  <h2>fread: Examples</h2>
  <ul>
    <li>Reading 1 int from binary file fp</li>
    <pre><code class="hljs lang-c">
int i;
fread(&amp;i, sizeof(int), 1, fp);
    </code></pre>
    <li>This means</li>
    <ul>
      <li>
        Read <span class="hl-orange">1</span> object from file
        <span class="hl-violet">fp</span>.
      </li>
      <li>Save result in <span class="hl-green">&amp;i</span>.</li>
      <li>
        The size of the object is <span class="hl-yellow">sizeof(int)</span>
      </li>
    </ul>
    <li>It reads 4 bytes from file and saves in &amp;i</li>
    <ul>
      <li>We read an integer from file and save it in i</li>
    </ul>
  </ul>
</section>
<section>
  <h2>fread: Examples</h2>
  <ul>
    <li>Read five floats</li>
    <pre><code class="hljs lang-c">
float farr[5];
fread(farr, sizeof(float), 5, fp);
    </code></pre>
    <li>This means</li>
    <ul>
      <li>
        Read <span class="hl-orange">5</span> objects from file
        <span class="hl-violet">fp</span>.
      </li>
      <li>Save result in <span class="hl-green">farr</span>.</li>
      <li>
        The size of each object is
        <span class="hl-yellow">sizeof(float)</span>
      </li>
    </ul>
    <li>It reads 20 bytes from file and saves in farr</li>
    <ul>
      <li>We read 5 floats from file and save them in farr</li>
    </ul>
  </ul>
</section>
<section>
  <h2>fwrite: Examples</h2>
  <ul>
    <li>Writing 1 char to binary file fp</li>
    <pre><code class="hljs lang-c">
char c = 'A';
fwrite(&amp;c, sizeof(char), 1, fp);
    </code></pre>
    <li>This means</li>
    <ul>
      <li>
        Write <span class="hl-orange">1</span> object from
        <span class="hl-green">&amp;c</span> into file
        <span class="hl-violet">fp</span>.
      </li>
      <li>Size of the object is <span class="hl-yellow">sizeof(char)</span></li>
    </ul>
    <li>It writes 1 byte from address &amp;c and saves result in file</li>
    <ul>
      <li>We write char c to the file</li>
    </ul>
  </ul>
</section>
<section>
  <h2>fwrite: Examples</h2>
  <ul>
    <li>Writing 4 doubles to binary file fp</li>
    <pre><code class="hljs lang-c">
double darr[4];
fwrite(darr, sizeof(double), 4, fp);
    </code></pre>
    <li>This means</li>
    <ul>
      <li>
        Write <span class="hl-orange">4</span> object from
        <span class="hl-green">darr</span> into file
        <span class="hl-violet">fp</span>.
      </li>
      <li>
        Size of the object is <span class="hl-yellow">sizeof(double)</span>
      </li>
    </ul>
    <li>It writes 32 bytes from address darr and saves result in file</li>
    <ul>
      <li>We write the array of double to the file</li>
    </ul>
  </ul>
</section>
<section>
  <h2></h2>
  <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;

struct point{
  int x, y;
};

int main() {
  FILE* fp;
  struct point p;
  int i;

  fp = fopen("points.bin", "wb");
  if (fp == NULL) {
    printf("Cannot create file\n");
    return -1;
  }

  for(i = 0; i &lt; 5; i++) {
    printf("Enter X and Y: ");
    scanf("%d %d", &amp;p.x, &amp;p.y);
    fwrite(&amp;p, sizeof(p), 1, fp);
  }

  fclose(fp);
  return 0;
}
  </code></pre>
</section>
<section>
  <h2></h2>
  <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;
struct point{
  int x, y;
};

int main() {
  FILE* fp;
  struct point p;
  int i;
  fp = fopen("points.bin", "rb");
  if(fp == NULL){
    printf("Cannot read from file\n");
    return -1;
  }

  while(1){
    if(fread(&amp;p, sizeof(p), 1, fp) &lt; 1)
      break;
    printf("X = %d, and Y = %d\n", p.x, p.y);
  }

  fclose(fp);
  return 0;
}
  </code></pre>
</section>
<section>
  <h2>Sequential and Random Accesses</h2>
  <ul>
    <li>The access to file is sequential if</li>
    <ul>
      <li>If we don’t move the FPP manually</li>
      <li>FPP advances through read and write</li>
    </ul>
    <li>The access to file is Random</li>
    <ul>
      <li>FPP advances through read and write</li>
      <li>We can also move the FPP manually</li>
    </ul>
    <li>File processing can uses Random access</li>
  </ul>
</section>
<section>
  <h2>Moving FPP, Why?</h2>
  <ul>
    <li>To access randomly</li>
    <li>
      Consider very large file (information about all students in the
      university)
    </li>
    <li>Change the name of 5000th student</li>
    <ul>
      <li>If it is saved in text file</li>
      <ul>
        <li>Read 4999 lines, skip them and change the 5000th</li>
      </ul>
      <li>If it is saved in binary file and each object has the same size</li>
      <ul>
        <li>Jump to the 5000th object by fseek</li>
        <li>Why we cannot do the same for text files? More on this later</li>
      </ul>
    </ul>
  </ul>
</section>
<section>
  <h2>Moving FPP</h2>
  <pre><code class="hljs lang-c">
int fseek(FILE *fp, long offset, int org)
  </code></pre>
  <ul>
    <li>Set FPP in the offset respect to org</li>
    <li>org:</li>
    <ul>
      <li>SEEK_SET: start of file</li>
      <li>SEEK_CUR: current FPP</li>
      <li>SEEK_END: End of file</li>
    </ul>
    <li>Returns nonzero if it is unsuccessful</li>
  </ul>
</section>
<section>
  <pre><code class="hljs">
(1,1)(2,2)(3,3)(4,4)(5,5)
  </code></pre>
  <pre><code class="hljs lang-c">
fp = fopen("points.bin", "rb");

fread(&amp;p, sizeof(p), 1, fp);
printf("%d %d\n", p.x, p.y); // 1 1

fseek(fp, 2 * sizeof(p), SEEK_SET);
fread(&amp;p, sizeof(p), 1, fp);
printf("%d %d\n", p.x, p.y); // 3 3

fseek(fp, -3 * sizeof(p), SEEK_END);
fread(&amp;p, sizeof(p), 1,fp);
printf("%d %d\n", p.x, p.y); // 3 3

fseek(fp, 1 * sizeof(p), SEEK_CUR);
fread(&amp;p, sizeof(p), 1, fp); // 5 5
printf("%d %d\n", p.x, p.y);
  </code></pre>
</section>
<section>
  <h2>Other FPP related functions</h2>
  <ul>
    <li>Find out where is the FPP</li>
    <pre><code class="hljs lang-c">
int ftell(FILE *fp)
    </code></pre>
    <li>ftell returns the current FPP</li>
    <ul>
      <li>With respect to SEEK_SET</li>
    </ul>
    <li>Reset the FPP to the start of file</li>
    <pre><code class="hljs lang-c">
void rewind(FILE *fp)
    </code></pre>
  </ul>
</section>
<section>
  <pre><code class="hljs lang-c">
#include &lt;stdio.h&gt;

struct point{
  int x, y;
};

int main(void){
   FILE* fp;

  struct point p;
  int num;

  fp = fopen("points.bin", "rb+");
  if (fp == NULL){
    printf("Cannot read from file\n");
    return -1;
  }

  printf("Enter the number of points: ");
  scanf("%d", &amp;num);

  printf("Enter new X and Y: ");
  scanf("%d %d", &amp;(p.x), &amp;(p.y));

  fseek(fp, (num – 1) * sizeof(p), SEEK_SET);
  fwrite(&amp;p, sizeof(p), 1, fp);

  fclose(fp);

  return 0;
}
  </code></pre>
</section>
<section>
  <h2>fseek in Text files</h2>
  <ul>
    <li>Not very useful</li>
    <li>Offset counts the number of characters including ‘\n’</li>
    <li>Typical useful versions</li>
    <ul>
      <li>Go to the start of file</li>
      <pre><code class="hljs lang-c">
fseek(fp, 0, SEEK_SET)
      </code></pre>
      <li>Go to the end of file</li>
      <pre><code class="hljs lang-c">
fseek(fp, 0, SEEK_END)
      </code></pre>
    </ul>
  </ul>
</section>
<section>
  <div class="toc" data-selected="3"></div>
</section>
<section>
  <h2>Common Bugs and Avoiding Them</h2>
  <ul>
    <li>Take care about mode in fopen</li>
    <ul>
      <li>w &amp; w+: all data in file will be lost</li>
      <li>r: you cannot write. fprintf does not do any thing</li>
    </ul>
    <li>Take care about text or binary</li>
    <ul>
      <li>fscanf/fprintf don’t do meaningful job in binary files</li>
    </ul>
    <li>Check the successful open: fp != NULL</li>
    <li>Check EOF as much as possible.</li>
    <li>Close the open files.</li>
  </ul>
</section>
<section>
  <section>
    <h2>Legends</h2>
    <img src="./img/yoda.jpg" alt="yoda" />
  </section>
  <section>
    <h6 class="fragment" data-fragment-index="1" style="color: #ff99ff">You</h6>
    <ul class="fragment" data-fragment-index="2">
      Thanks for attending this course
    </ul>
  </section>
</section>
